libs-y += lib/liblkl

ifneq ($(LKL_HOST_CONFIG_BSD),y)
libs-$(LKL_HOST_CONFIG_POSIX) += lib/hijack/liblkl-hijack
endif
LDFLAGS_lib/hijack/liblkl-hijack-y += -shared -nodefaultlibs
LDLIBS_lib/hijack/liblkl-hijack-y += -ldl
LDLIBS_lib/hijack/liblkl-hijack-$(LKL_HOST_CONFIG_ARM) += -lgcc -lc
LDLIBS_lib/hijack/liblkl-hijack-$(LKL_HOST_CONFIG_AARCH64) += -lc
LDLIBS_lib/hijack/liblkl-hijack-$(LKL_HOST_CONFIG_I386) += -lc_nonshared

progs-$(LKL_HOST_CONFIG_FUSE_IGNORE) += lklfuse
LDLIBS_lklfuse-y := -lfuse

progs-$(LKL_HOST_CONFIG_ARCHIVE_IGNORE) += fs2tar
LDLIBS_fs2tar-y := -larchive
LDLIBS_fs2tar-$(LKL_HOST_CONFIG_NEEDS_LARGP) += -largp


progs-$(LKL_HOST_CONFIG_ARCHIVE_IGNORE) += cptofs
LDLIBS_cptofs-y := -larchive
LDLIBS_cptofs-$(LKL_HOST_CONFIG_NEEDS_LARGP) += -largp

progs-$(LKL_TEST) += tests/boot
progs-$(LKL_TEST) += tests/disk
progs-$(LKL_TEST) += tests/disk-vfio-pci
progs-$(LKL_TEST) += tests/net-test
progs-$(LKL_TEST) += tests/virt-pci
progs-$(LKL_TEST) += tests/virt-pci-test

LDFLAGS_harness/libfuzzer-harness-$(LKL_LIBFUZZER) += -fsanitize=fuzzer
CFLAGS_harness/libfuzzer-harness-$(LKL_LIBFUZZER) += -Itests
progs-$(LKL_LIBFUZZER) += harness/libfuzzer-harness


LDFLAGS_harness/afl-harness-y += $(HOME)/Workspace/git/AFLplusplus/afl-llvm-rt-64.o -rdynamic
progs-y += harness/afl-harness

LDFLAGS_harness/tests/kasan-test-soob-y += $(HOME)/Workspace/git/AFLplusplus/afl-llvm-rt-64.o
progs-y += harness/tests/kasan-test-soob

LDFLAGS_harness/tests/kasan-test-uaf-y += $(HOME)/Workspace/git/AFLplusplus/afl-llvm-rt-64.o
progs-y += harness/tests/kasan-test-uaf

